<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>README.markdown - RDoc Documentation</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body class="file">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  
<div id="table-of-contents">
  <nav class="section">
    <h3 class="section-header">Table of Contents</h3>
    <ul>
      <li><a href="#label-firewall">firewall</a>
      <li><a href="#label-Table+of+Contents">Table of Contents</a>
      <li><a href="#label-Overview">Overview</a>
      <li><a href="#label-Module+Description">Module Description</a>
      <li><a href="#label-Setup">Setup</a>
      <li><a href="#label-What+Firewall+Affects">What Firewall Affects</a>
      <li><a href="#label-Setup+Requirements">Setup Requirements</a>
      <li><a href="#label-Beginning+with+Firewall">Beginning with Firewall</a>
      <li><a href="#label-Create+the+my_fw%3A%3Apre+and+my_fw%3A%3Apost+Classes">Create the <code>my_fw::pre</code> and <code>my_fw::post</code> Classes</a>
      <li><a href="#label-Create+Firewall+Rules">Create Firewall Rules</a>
      <li><a href="#label-Upgrading">Upgrading</a>
      <li><a href="#label-From+version+0.2.0+and+more+recent">From version 0.2.0 and more recent</a>
      <li><a href="#label-Usage">Usage</a>
      <li><a href="#label-Default+Rules">Default Rules</a>
      <li><a href="#label-Examples+of+Default+Rules">Examples of Default Rules</a>
      <li><a href="#label-Application-Specific+Rules">Application-Specific Rules</a>
      <li><a href="#label-Rule+inversion">Rule inversion</a>
      <li><a href="#label-Additional+Uses+for+the+Firewall+Module">Additional Uses for the Firewall Module</a>
      <li><a href="#label-Additional+Information">Additional Information</a>
      <li><a href="#label-Reference">Reference</a>
      <li><a href="#label-Class%3A+firewall">Class: firewall</a>
      <li><a href="#label-ensure"><code>ensure</code></a>
      <li><a href="#label-Type%3A+firewall">Type: firewall</a>
      <li><a href="#label-Providers">Providers</a>
      <li><a href="#label-Features">Features</a>
      <li><a href="#label-Parameters">Parameters</a>
      <li><a href="#label-Type%3A+firewallchain">Type: firewallchain</a>
      <li><a href="#label-Providers">Providers</a>
      <li><a href="#label-Features">Features</a>
      <li><a href="#label-Parameters">Parameters</a>
      <li><a href="#label-Fact%3A+ip6tables_version">Fact: ip6tables_version</a>
      <li><a href="#label-Fact%3A+iptables_version">Fact: iptables_version</a>
      <li><a href="#label-Fact%3A+iptables_persistent_version">Fact: iptables_persistent_version</a>
      <li><a href="#label-Limitations">Limitations</a>
      <li><a href="#label-SLES">SLES</a>
      <li><a href="#label-Oracle+Enterprise+Linux">Oracle Enterprise Linux</a>
      <li><a href="#label-Other">Other</a>
      <li><a href="#label-Development">Development</a>
      <li><a href="#label-Testing">Testing</a>
    </ul>
  </nav>
</div>


  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../../modules/apache/CHANGELOG_md.html">CHANGELOG</a>
  
    <li class="file"><a href="../../modules/apache/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li class="file"><a href="../../modules/apache/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/apache/LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../../modules/apache/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/apache/README_passenger_md.html">README.passenger</a>
  
    <li class="file"><a href="../../modules/apache/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/apache/checksums_json.html">checksums.json</a>
  
    <li class="file"><a href="../../modules/apache/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/apt/CHANGELOG_md.html">CHANGELOG</a>
  
    <li class="file"><a href="../../modules/apt/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li class="file"><a href="../../modules/apt/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/apt/LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../../modules/apt/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/apt/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/apt/checksums_json.html">checksums.json</a>
  
    <li class="file"><a href="../../modules/apt/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/base/Modulefile.html">Modulefile</a>
  
    <li class="file"><a href="../../modules/base/README.html">README</a>
  
    <li class="file"><a href="../../modules/concat/CHANGELOG_md.html">CHANGELOG</a>
  
    <li class="file"><a href="../../modules/concat/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li class="file"><a href="../../modules/concat/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/concat/LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../../modules/concat/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/concat/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/concat/checksums_json.html">checksums.json</a>
  
    <li class="file"><a href="../../modules/concat/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/firewall/CHANGELOG_md.html">CHANGELOG</a>
  
    <li class="file"><a href="../../modules/firewall/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li class="file"><a href="../../modules/firewall/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/firewall/LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../../modules/firewall/README_markdown.html">README.markdown</a>
  
    <li class="file"><a href="../../modules/firewall/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/firewall/checksums_json.html">checksums.json</a>
  
    <li class="file"><a href="../../modules/firewall/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/heartbeat/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/module_data/Modulefile.html">Modulefile</a>
  
    <li class="file"><a href="../../modules/module_data/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/module_data/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/mysql/CHANGELOG_md.html">CHANGELOG</a>
  
    <li class="file"><a href="../../modules/mysql/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/mysql/Gemfile_lock.html">Gemfile.lock</a>
  
    <li class="file"><a href="../../modules/mysql/LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../../modules/mysql/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/mysql/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/mysql/TODO.html">TODO</a>
  
    <li class="file"><a href="../../modules/mysql/checksums_json.html">checksums.json</a>
  
    <li class="file"><a href="../../modules/mysql/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/nginx/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li class="file"><a href="../../modules/nginx/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/nginx/Gemfile_lock.html">Gemfile.lock</a>
  
    <li class="file"><a href="../../modules/nginx/LICENSE_md.html">LICENSE</a>
  
    <li class="file"><a href="../../modules/nginx/README_markdown.html">README.markdown</a>
  
    <li class="file"><a href="../../modules/nginx/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/nginx/checksums_json.html">checksums.json</a>
  
    <li class="file"><a href="../../modules/nginx/composer_json.html">composer.json</a>
  
    <li class="file"><a href="../../modules/nginx/data/common_yaml.html">common.yaml</a>
  
    <li class="file"><a href="../../modules/nginx/data/hiera_yaml.html">hiera.yaml</a>
  
    <li class="file"><a href="../../modules/nginx/data/operatingsystem/SmartOS_yaml.html">SmartOS.yaml</a>
  
    <li class="file"><a href="../../modules/nginx/data/osfamily/Archlinux_yaml.html">Archlinux.yaml</a>
  
    <li class="file"><a href="../../modules/nginx/data/osfamily/Debian_yaml.html">Debian.yaml</a>
  
    <li class="file"><a href="../../modules/nginx/data/osfamily/FreeBSD_yaml.html">FreeBSD.yaml</a>
  
    <li class="file"><a href="../../modules/nginx/data/osfamily/Solaris_yaml.html">Solaris.yaml</a>
  
    <li class="file"><a href="../../modules/nginx/docs/hiera_md.html">hiera</a>
  
    <li class="file"><a href="../../modules/nginx/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/profiles/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/profiles/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/profiles/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/profiles/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/roles/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/roles/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/roles/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/roles/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/stdlib/CHANGELOG_md.html">CHANGELOG</a>
  
    <li class="file"><a href="../../modules/stdlib/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li class="file"><a href="../../modules/stdlib/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/stdlib/LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../../modules/stdlib/README_markdown.html">README.markdown</a>
  
    <li class="file"><a href="../../modules/stdlib/README_DEVELOPER_markdown.html">README_DEVELOPER.markdown</a>
  
    <li class="file"><a href="../../modules/stdlib/README_SPECS_markdown.html">README_SPECS.markdown</a>
  
    <li class="file"><a href="../../modules/stdlib/RELEASE_PROCESS_markdown.html">RELEASE_PROCESS.markdown</a>
  
    <li class="file"><a href="../../modules/stdlib/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/stdlib/checksums_json.html">checksums.json</a>
  
    <li class="file"><a href="../../modules/stdlib/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/thing/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/thomas-base/Modulefile.html">Modulefile</a>
  
    <li class="file"><a href="../../modules/thomas-base/README.html">README</a>
  
    <li class="file"><a href="../../modules/thomas-profiles/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/thomas-profiles/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/thomas-profiles/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/thomas-profiles/metadata_json.html">metadata.json</a>
  
    <li class="file"><a href="../../modules/thomas-roles/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../modules/thomas-roles/README_md.html">README</a>
  
    <li class="file"><a href="../../modules/thomas-roles/Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../modules/thomas-roles/metadata_json.html">metadata.json</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../__site__.html">__site__</a>
  
    <li><a href="../../admin.html">admin</a>
  
    <li><a href="../../admin/__functions__.html">admin::__functions__</a>
  
    <li><a href="../../admin/percona_repo.html">admin::percona_repo</a>
  
    <li><a href="../../admin/stages.html">admin::stages</a>
  
    <li><a href="../../admin/stages/me_first.html">admin::stages::me_first</a>
  
    <li><a href="../../admin/stages/me_last.html">admin::stages::me_last</a>
  
    <li><a href="../../admin_user.html">admin_user</a>
  
    <li><a href="../../apache.html">apache</a>
  
    <li><a href="../../apache.cookbook.html">apache.cookbook</a>
  
    <li><a href="../../apache.cookbook/apache.html">apache.cookbook::apache</a>
  
    <li><a href="../../apache/__types__.html">apache::__types__</a>
  
    <li><a href="../../apache/confd.html">apache::confd</a>
  
    <li><a href="../../apache/confd/no_accf.html">apache::confd::no_accf</a>
  
    <li><a href="../../apache/default_confd_files.html">apache::default_confd_files</a>
  
    <li><a href="../../apache/default_mods.html">apache::default_mods</a>
  
    <li><a href="../../apache/dev.html">apache::dev</a>
  
    <li><a href="../../apache/mod.html">apache::mod</a>
  
    <li><a href="../../apache/mod/actions.html">apache::mod::actions</a>
  
    <li><a href="../../apache/mod/alias.html">apache::mod::alias</a>
  
    <li><a href="../../apache/mod/auth_basic.html">apache::mod::auth_basic</a>
  
    <li><a href="../../apache/mod/auth_kerb.html">apache::mod::auth_kerb</a>
  
    <li><a href="../../apache/mod/authnz_ldap.html">apache::mod::authnz_ldap</a>
  
    <li><a href="../../apache/mod/autoindex.html">apache::mod::autoindex</a>
  
    <li><a href="../../apache/mod/cache.html">apache::mod::cache</a>
  
    <li><a href="../../apache/mod/cgi.html">apache::mod::cgi</a>
  
    <li><a href="../../apache/mod/cgid.html">apache::mod::cgid</a>
  
    <li><a href="../../apache/mod/dav.html">apache::mod::dav</a>
  
    <li><a href="../../apache/mod/dav_fs.html">apache::mod::dav_fs</a>
  
    <li><a href="../../apache/mod/dav_svn.html">apache::mod::dav_svn</a>
  
    <li><a href="../../apache/mod/deflate.html">apache::mod::deflate</a>
  
    <li><a href="../../apache/mod/dev.html">apache::mod::dev</a>
  
    <li><a href="../../apache/mod/dir.html">apache::mod::dir</a>
  
    <li><a href="../../apache/mod/disk_cache.html">apache::mod::disk_cache</a>
  
    <li><a href="../../apache/mod/event.html">apache::mod::event</a>
  
    <li><a href="../../apache/mod/expires.html">apache::mod::expires</a>
  
    <li><a href="../../apache/mod/fastcgi.html">apache::mod::fastcgi</a>
  
    <li><a href="../../apache/mod/fcgid.html">apache::mod::fcgid</a>
  
    <li><a href="../../apache/mod/headers.html">apache::mod::headers</a>
  
    <li><a href="../../apache/mod/include.html">apache::mod::include</a>
  
    <li><a href="../../apache/mod/info.html">apache::mod::info</a>
  
    <li><a href="../../apache/mod/itk.html">apache::mod::itk</a>
  
    <li><a href="../../apache/mod/ldap.html">apache::mod::ldap</a>
  
    <li><a href="../../apache/mod/mime.html">apache::mod::mime</a>
  
    <li><a href="../../apache/mod/mime_magic.html">apache::mod::mime_magic</a>
  
    <li><a href="../../apache/mod/negotiation.html">apache::mod::negotiation</a>
  
    <li><a href="../../apache/mod/nss.html">apache::mod::nss</a>
  
    <li><a href="../../apache/mod/pagespeed.html">apache::mod::pagespeed</a>
  
    <li><a href="../../apache/mod/passenger.html">apache::mod::passenger</a>
  
    <li><a href="../../apache/mod/perl.html">apache::mod::perl</a>
  
    <li><a href="../../apache/mod/peruser.html">apache::mod::peruser</a>
  
    <li><a href="../../apache/mod/php.html">apache::mod::php</a>
  
    <li><a href="../../apache/mod/prefork.html">apache::mod::prefork</a>
  
    <li><a href="../../apache/mod/proxy.html">apache::mod::proxy</a>
  
    <li><a href="../../apache/mod/proxy_ajp.html">apache::mod::proxy_ajp</a>
  
    <li><a href="../../apache/mod/proxy_balancer.html">apache::mod::proxy_balancer</a>
  
    <li><a href="../../apache/mod/proxy_html.html">apache::mod::proxy_html</a>
  
    <li><a href="../../apache/mod/proxy_http.html">apache::mod::proxy_http</a>
  
    <li><a href="../../apache/mod/python.html">apache::mod::python</a>
  
    <li><a href="../../apache/mod/reqtimeout.html">apache::mod::reqtimeout</a>
  
    <li><a href="../../apache/mod/rewrite.html">apache::mod::rewrite</a>
  
    <li><a href="../../apache/mod/rpaf.html">apache::mod::rpaf</a>
  
    <li><a href="../../apache/mod/setenvif.html">apache::mod::setenvif</a>
  
    <li><a href="../../apache/mod/speling.html">apache::mod::speling</a>
  
    <li><a href="../../apache/mod/ssl.html">apache::mod::ssl</a>
  
    <li><a href="../../apache/mod/status.html">apache::mod::status</a>
  
    <li><a href="../../apache/mod/suexec.html">apache::mod::suexec</a>
  
    <li><a href="../../apache/mod/suphp.html">apache::mod::suphp</a>
  
    <li><a href="../../apache/mod/userdir.html">apache::mod::userdir</a>
  
    <li><a href="../../apache/mod/vhost_alias.html">apache::mod::vhost_alias</a>
  
    <li><a href="../../apache/mod/worker.html">apache::mod::worker</a>
  
    <li><a href="../../apache/mod/wsgi.html">apache::mod::wsgi</a>
  
    <li><a href="../../apache/mod/xsendfile.html">apache::mod::xsendfile</a>
  
    <li><a href="../../apache/package.html">apache::package</a>
  
    <li><a href="../../apache/params.html">apache::params</a>
  
    <li><a href="../../apache/peruser.html">apache::peruser</a>
  
    <li><a href="../../apache/php.html">apache::php</a>
  
    <li><a href="../../apache/proxy.html">apache::proxy</a>
  
    <li><a href="../../apache/python.html">apache::python</a>
  
    <li><a href="../../apache/service.html">apache::service</a>
  
    <li><a href="../../apache/ssl.html">apache::ssl</a>
  
    <li><a href="../../apache/version.html">apache::version</a>
  
    <li><a href="../../apt.html">apt</a>
  
    <li><a href="../../apt/__facts__.html">apt::__facts__</a>
  
    <li><a href="../../apt/__types__.html">apt::__types__</a>
  
    <li><a href="../../apt/apt.html">apt::apt</a>
  
    <li><a href="../../apt/backports.html">apt::backports</a>
  
    <li><a href="../../apt/debian.html">apt::debian</a>
  
    <li><a href="../../apt/debian/testing.html">apt::debian::testing</a>
  
    <li><a href="../../apt/debian/unstable.html">apt::debian::unstable</a>
  
    <li><a href="../../apt/params.html">apt::params</a>
  
    <li><a href="../../apt/release.html">apt::release</a>
  
    <li><a href="../../apt/unattended_upgrades.html">apt::unattended_upgrades</a>
  
    <li><a href="../../apt/update.html">apt::update</a>
  
    <li><a href="../../base.html">base</a>
  
    <li><a href="../../base/base.html">base::base</a>
  
    <li><a href="../../base/ssh_host.html">base::ssh_host</a>
  
    <li><a href="../../concat.html">concat</a>
  
    <li><a href="../../concat/__facts__.html">concat::__facts__</a>
  
    <li><a href="../../concat/__functions__.html">concat::__functions__</a>
  
    <li><a href="../../concat/setup.html">concat::setup</a>
  
    <li><a href="../../cookbook.html">cookbook</a>
  
    <li><a href="../../cookbook/__functions__.html">cookbook::__functions__</a>
  
    <li><a href="../../cron.html">cron</a>
  
    <li><a href="../../cron/cron.html">cron::cron</a>
  
    <li><a href="../../db.html">db</a>
  
    <li><a href="../../db/client.html">db::client</a>
  
    <li><a href="../../db/server.html">db::server</a>
  
    <li><a href="../../debug.html">debug</a>
  
    <li><a href="../../debug/debug.html">debug::debug</a>
  
    <li><a href="../../drupal.html">drupal</a>
  
    <li><a href="../../drupal/drupal.html">drupal::drupal</a>
  
    <li><a href="../../enc.html">enc</a>
  
    <li><a href="../../enc/enc.html">enc::enc</a>
  
    <li><a href="../../facts.html">facts</a>
  
    <li><a href="../../firewall.html">firewall</a>
  
    <li><a href="../../firewall/__types__.html">firewall::__types__</a>
  
    <li><a href="../../firewall/firewall.html">firewall::firewall</a>
  
    <li><a href="../../firewall/linux.html">firewall::linux</a>
  
    <li><a href="../../firewall/linux/archlinux.html">firewall::linux::archlinux</a>
  
    <li><a href="../../firewall/linux/debian.html">firewall::linux::debian</a>
  
    <li><a href="../../firewall/linux/redhat.html">firewall::linux::redhat</a>
  
    <li><a href="../../greeting.html">greeting</a>
  
    <li><a href="../../greeting/greeting.html">greeting::greeting</a>
  
    <li><a href="../../haproxy.html">haproxy</a>
  
    <li><a href="../../haproxy/config.html">haproxy::config</a>
  
    <li><a href="../../haproxy/master.html">haproxy::master</a>
  
    <li><a href="../../haproxy/slave.html">haproxy::slave</a>
  
    <li><a href="../../heartbeat.html">heartbeat</a>
  
    <li><a href="../../heartbeat/heartbeat.html">heartbeat::heartbeat</a>
  
    <li><a href="../../heartbeat/vip.html">heartbeat::vip</a>
  
    <li><a href="../../jumpbox.html">jumpbox</a>
  
    <li><a href="../../jumpbox/jumpbox.html">jumpbox::jumpbox</a>
  
    <li><a href="../../lisa.html">lisa</a>
  
    <li><a href="../../module_data.html">module_data</a>
  
    <li><a href="../../myfw.html">myfw</a>
  
    <li><a href="../../myfw/myfw.html">myfw::myfw</a>
  
    <li><a href="../../myfw/post.html">myfw::post</a>
  
    <li><a href="../../myfw/pre.html">myfw::pre</a>
  
    <li><a href="../../mysql.html">mysql</a>
  
    <li><a href="../../mysql.cookbook.html">mysql.cookbook</a>
  
    <li><a href="../../mysql.cookbook/mysql.html">mysql.cookbook::mysql</a>
  
    <li><a href="../../mysql/__functions__.html">mysql::__functions__</a>
  
    <li><a href="../../mysql/__types__.html">mysql::__types__</a>
  
    <li><a href="../../mysql/backup.html">mysql::backup</a>
  
    <li><a href="../../mysql/bindings.html">mysql::bindings</a>
  
    <li><a href="../../mysql/bindings/java.html">mysql::bindings::java</a>
  
    <li><a href="../../mysql/bindings/perl.html">mysql::bindings::perl</a>
  
    <li><a href="../../mysql/bindings/php.html">mysql::bindings::php</a>
  
    <li><a href="../../mysql/bindings/python.html">mysql::bindings::python</a>
  
    <li><a href="../../mysql/bindings/ruby.html">mysql::bindings::ruby</a>
  
    <li><a href="../../mysql/client.html">mysql::client</a>
  
    <li><a href="../../mysql/client/install.html">mysql::client::install</a>
  
    <li><a href="../../mysql/params.html">mysql::params</a>
  
    <li><a href="../../mysql/server.html">mysql::server</a>
  
    <li><a href="../../mysql/server/account_security.html">mysql::server::account_security</a>
  
    <li><a href="../../mysql/server/backup.html">mysql::server::backup</a>
  
    <li><a href="../../mysql/server/config.html">mysql::server::config</a>
  
    <li><a href="../../mysql/server/install.html">mysql::server::install</a>
  
    <li><a href="../../mysql/server/monitor.html">mysql::server::monitor</a>
  
    <li><a href="../../mysql/server/mysqltuner.html">mysql::server::mysqltuner</a>
  
    <li><a href="../../mysql/server/providers.html">mysql::server::providers</a>
  
    <li><a href="../../mysql/server/root_password.html">mysql::server::root_password</a>
  
    <li><a href="../../mysql/server/service.html">mysql::server::service</a>
  
    <li><a href="../../nfs.html">nfs</a>
  
    <li><a href="../../nfs/exports.html">nfs::exports</a>
  
    <li><a href="../../nfs/server.html">nfs::server</a>
  
    <li><a href="../../nfs/server/debian.html">nfs::server::debian</a>
  
    <li><a href="../../nfs/server/redhat.html">nfs::server::redhat</a>
  
    <li><a href="../../nginx.html">nginx</a>
  
    <li><a href="../../nginx/config.html">nginx::config</a>
  
    <li><a href="../../nginx/nginx.html">nginx::nginx</a>
  
    <li><a href="../../nginx/notice.html">nginx::notice</a>
  
    <li><a href="../../nginx/notice/puppet_module_data.html">nginx::notice::puppet_module_data</a>
  
    <li><a href="../../nginx/package.html">nginx::package</a>
  
    <li><a href="../../nginx/package/archlinux.html">nginx::package::archlinux</a>
  
    <li><a href="../../nginx/package/debian.html">nginx::package::debian</a>
  
    <li><a href="../../nginx/package/freebsd.html">nginx::package::freebsd</a>
  
    <li><a href="../../nginx/package/gentoo.html">nginx::package::gentoo</a>
  
    <li><a href="../../nginx/package/redhat.html">nginx::package::redhat</a>
  
    <li><a href="../../nginx/package/solaris.html">nginx::package::solaris</a>
  
    <li><a href="../../nginx/package/suse.html">nginx::package::suse</a>
  
    <li><a href="../../nginx/resource.html">nginx::resource</a>
  
    <li><a href="../../nginx/resource/upstream.html">nginx::resource::upstream</a>
  
    <li><a href="../../nginx/service.html">nginx::service</a>
  
    <li><a href="../../nothing.html">nothing</a>
  
    <li><a href="../../nothing/nothing.html">nothing::nothing</a>
  
    <li><a href="../../one.html">one</a>
  
    <li><a href="../../one/one.html">one::one</a>
  
    <li><a href="../../profiles.html">profiles</a>
  
    <li><a href="../../profiles/apache.html">profiles::apache</a>
  
    <li><a href="../../profiles/base.html">profiles::base</a>
  
    <li><a href="../../profiles/profiles.html">profiles::profiles</a>
  
    <li><a href="../../puppet.html">puppet</a>
  
    <li><a href="../../puppet/puppet.html">puppet::puppet</a>
  
    <li><a href="../../roles.html">roles</a>
  
    <li><a href="../../roles/roles.html">roles::roles</a>
  
    <li><a href="../../roles/webserver.html">roles::webserver</a>
  
    <li><a href="../../ssh_user.html">ssh_user</a>
  
    <li><a href="../../stdlib.html">stdlib</a>
  
    <li><a href="../../stdlib/__facts__.html">stdlib::__facts__</a>
  
    <li><a href="../../stdlib/__functions__.html">stdlib::__functions__</a>
  
    <li><a href="../../stdlib/__types__.html">stdlib::__types__</a>
  
    <li><a href="../../stdlib/stages.html">stdlib::stages</a>
  
    <li><a href="../../stdlib/stdlib.html">stdlib::stdlib</a>
  
    <li><a href="../../thing.html">thing</a>
  
    <li><a href="../../thing/thing.html">thing::thing</a>
  
    <li><a href="../../thomas-base.html">thomas-base</a>
  
    <li><a href="../../thomas-profiles.html">thomas-profiles</a>
  
    <li><a href="../../thomas-roles.html">thomas-roles</a>
  
    <li><a href="../../two.html">two</a>
  
    <li><a href="../../two/two.html">two::two</a>
  
    <li><a href="../../user.html">user</a>
  
    <li><a href="../../user/developers.html">user::developers</a>
  
    <li><a href="../../user/sysadmins.html">user::sysadmins</a>
  
    <li><a href="../../user/virtual.html">user::virtual</a>
  
    <li><a href="../../virtual.html">virtual</a>
  
    <li><a href="../../virtual/virtual.html">virtual::virtual</a>
  
    <li><a href="../../wordpress.html">wordpress</a>
  
    <li><a href="../../wordpress/wordpress.html">wordpress::wordpress</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation" class="description">
  
<h1 id="label-firewall">firewall<span><a href="#label-firewall">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p><a
href="https://travis-ci.org/puppetlabs/puppetlabs-firewall.png?branch=master">{Build
Status</a>]</p>

<h4 id="label-Table+of+Contents">Table of Contents<span><a href="#label-Table+of+Contents">&para;</a> <a href="#documentation">&uarr;</a></span></h4>
<ol><li>
<p><a href="#overview">Overview - What is the Firewall module?</a></p>
</li><li>
<p><a href="#module-description">Module Description - What does the module
do?</a></p>
</li><li>
<p><a href="#setup">Setup - The basics of getting started with Firewall</a></p>
<ul><li>
<p><a href="#what-firewall-affects">What Firewall Affects</a></p>
</li><li>
<p><a href="#setup-requirements">Setup Requirements</a></p>
</li><li>
<p><a href="#beginning-with-firewall">Beginning with Firewall</a></p>
</li><li>
<p><a href="#upgrading">Upgrading</a></p>
</li></ul>
</li><li>
<p><a href="#usage">Usage - Configuration and customization options</a></p>
<ul><li>
<p><a href="#default-rules">Default rules - Setting up general configurations
for all firewalls</a></p>
</li><li>
<p><a href="#application-specific-rules">Application-Specific Rules - Options
for configuring and managing firewalls across applications</a></p>
</li><li>
<p><a href="#other-rules">Additional Uses for the Firewall Module</a></p>
</li></ul>
</li><li>
<p><a href="#reference">Reference - An under-the-hood peek at what the module
is doing</a></p>
</li><li>
<p><a href="#limitations">Limitations - OS compatibility, etc.</a></p>
</li><li>
<p><a href="#development">Development - Guide for contributing to the
module</a></p>
<ul><li>
<p><a href="#tests">Tests - Testing your configuration</a></p>
</li></ul>
</li></ol>

<h2 id="label-Overview">Overview<span><a href="#label-Overview">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>The Firewall module lets you manage firewall rules with Puppet.</p>

<h2 id="label-Module+Description">Module Description<span><a href="#label-Module+Description">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>PuppetLabs&#39; Firewall module introduces the <code>firewall</code>
resource, which is used to manage and configure firewall rules from within
the Puppet DSL. This module offers support for iptables and ip6tables. The
module also introduces the <code>firewallchain</code> resource, which
allows you to manage chains or firewall lists and ebtables for bridging
support. At the moment, only iptables and ip6tables chains are supported.</p>

<p>The Firewall module acts on your running firewall, making immediate changes
as the catalog executes. Defining default pre and post rules allows you to
provide global defaults for your hosts before and after any custom rules.
Defining <code>pre</code> and <code>post</code> rules is also necessary to
help you avoid locking yourself out of your own boxes when Puppet runs.</p>

<h2 id="label-Setup">Setup<span><a href="#label-Setup">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<h3 id="label-What+Firewall+Affects">What Firewall Affects<span><a href="#label-What+Firewall+Affects">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Every node running a firewall</p>
</li><li>
<p>Firewall settings in your system</p>
</li><li>
<p>Connection settings for managed nodes</p>
</li><li>
<p>Unmanaged resources (get purged)</p>
</li></ul>

<h3 id="label-Setup+Requirements">Setup Requirements<span><a href="#label-Setup+Requirements">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Firewall uses Ruby-based providers, so you must enable <a
href="http://docs.puppetlabs.com/guides/plugins_in_modules.html#enabling-pluginsync">pluginsync
enabled</a>.</p>

<h3 id="label-Beginning+with+Firewall">Beginning with Firewall<span><a href="#label-Beginning+with+Firewall">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>In the following two sections, you create new classes and then create
firewall rules related to those classes. These steps are optional, but
provide a framework for firewall rules, which is helpful if you’re just
starting to create them.</p>

<p>If you already have rules in place, then you don’t need to do these two
sections. However, be aware of the ordering of your firewall rules. The
module will dynamically apply rules in the order they appear in the
catalog, meaning a deny rule could be applied before the allow rules. This
might mean the module hasn’t established some of the important connections,
such as the connection to the Puppet master.</p>

<p>The following steps are designed to ensure that you keep your SSH and other
connections, primarily your connection to your Puppet master. If you create
the <code>pre</code> and <code>post</code> classes described in the first
section, then you also need to create the rules described in the second
section.</p>

<h4 id="label-Create+the+my_fw%3A%3Apre+and+my_fw%3A%3Apost+Classes">Create the <code>my_fw::pre</code> and <code>my_fw::post</code> Classes<span><a href="#label-Create+the+my_fw%3A%3Apre+and+my_fw%3A%3Apost+Classes">&para;</a> <a href="#documentation">&uarr;</a></span></h4>

<p>This approach employs a whitelist setup, so you can define what rules you
want and everything else is ignored rather than removed.</p>

<p>The code in this section does the following:</p>
<ul><li>
<p>The <code>require</code> parameter in <code>Firewall {}</code> ensures
<code>my_fw::pre</code> is run before any other rules.</p>
</li><li>
<p>In the <code>my_fw::post</code> class declaration, the <code>before</code>
parameter ensures <code>my_fw::post</code> is run after any other rules.</p>
</li></ul>

<p>Therefore, the run order is:</p>
<ul><li>
<p>The rules in <code>my_fw::pre</code></p>
</li><li>
<p>Your rules (defined in code)</p>
</li><li>
<p>The rules in <code>my_fw::post</code></p>
</li></ul>

<p>The rules in the <code>pre</code> and <code>post</code> classes are fairly
general. These two classes ensure that you retain connectivity and that you
drop unmatched packets appropriately. The rules you define in your
manifests are likely specific to the applications you run.</p>
<ol><li>
<p>Add the <code>pre</code> class to <code>my_fw/manifests/pre.pp</code>.
<code>pre.pp</code> should contain any default rules to be applied first.
The rules in this class should be added in the order you want them to run.</p>

<p>class my_fw::pre {  Firewall {  require =&gt; undef,  }</p>

<p># Default firewall rules  firewall { &#39;000 accept all icmp&#39;:  proto
=&gt; &#39;icmp&#39;,  action =&gt; &#39;accept&#39;,  }-&gt;  firewall {
&#39;001 accept all to lo interface&#39;:  proto =&gt; &#39;all&#39;, 
iniface =&gt; &#39;lo&#39;,  action =&gt; &#39;accept&#39;,  }-&gt; 
firewall { &#39;002 accept related established rules&#39;:  proto =&gt;
&#39;all&#39;,  state =&gt; [&#39;RELATED&#39;, &#39;ESTABLISHED&#39;], 
action =&gt; &#39;accept&#39;,  } }</p>
</li></ol>

<p>The rules in <code>pre</code> should allow basic networking (such as ICMP
and TCP) and ensure that existing connections are not closed.</p>
<ol><li>
<p>Add the <code>post</code> class to <code>my_fw/manifests/post.pp</code> and
include any default rules to be applied last.</p>

<p>class my_fw::post {  firewall { &#39;999 drop all&#39;:  proto =&gt;
&#39;all&#39;,  action =&gt; &#39;drop&#39;,  before =&gt; undef,  } }</p>
</li></ol>

<h4 id="label-Create+Firewall+Rules">Create Firewall Rules<span><a href="#label-Create+Firewall+Rules">&para;</a> <a href="#documentation">&uarr;</a></span></h4>

<p>The rules you create here are helpful if you don’t have any existing rules;
they help you order your firewall configurations so you don’t lock yourself
out of your box.</p>

<p>Rules are persisted automatically between reboots, although there are known
issues with ip6tables on older Debian/Ubuntu distributions. There are also
known issues with ebtables.</p>
<ol><li>
<p>In <code>site.pp</code> or another top-scope file, add the following code
to set up a metatype to purge unmanaged firewall resources. This will clear
any existing rules and make sure that only rules defined in Puppet exist on
the machine.</p>
</li></ol>

<p><strong>Note</strong> - This only purges IPv4 rules.</p>

<pre class="ruby"><span class="ruby-identifier">resources</span> { <span class="ruby-string">&quot;firewall&quot;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">purge</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
}
</pre>
<ol><li>
<p>Use the following code to set up the default parameters for all of the
firewall rules you will establish later. These defaults will ensure that
the <code>pre</code> and <code>post</code> classes are run in the correct
order to avoid locking you out of your box during the first Puppet run.</p>

<p>Firewall {  before =&gt; <a href="'my_fw::post'">Class</a>,  require =&gt;
<a href="'my_fw::pre'">Class</a>, }</p>
</li><li>
<p>Then, declare the <code>my_fw::pre</code> and <code>my_fw::post</code>
classes to satisfy dependencies. You can declare these classes using an
<strong>External Node Classifier</strong> or the following code:</p>

<p>class { [&#39;my_fw::pre&#39;, &#39;my_fw::post&#39;]: }</p>
</li><li>
<p>Include the <code>firewall</code> class to ensure the correct packages are
installed.</p>

<p>class { &#39;firewall&#39;: }</p>
</li></ol>

<h3 id="label-Upgrading">Upgrading<span><a href="#label-Upgrading">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Use these steps if you already have a version of the Firewall module
installed.</p>

<h4 id="label-From+version+0.2.0+and+more+recent">From version 0.2.0 and more recent<span><a href="#label-From+version+0.2.0+and+more+recent">&para;</a> <a href="#documentation">&uarr;</a></span></h4>

<p>Upgrade the module with the puppet module tool as normal:</p>

<pre class="ruby"><span class="ruby-identifier">puppet</span> <span class="ruby-keyword">module</span> <span class="ruby-identifier">upgrade</span> <span class="ruby-identifier">puppetlabs</span><span class="ruby-operator">/</span><span class="ruby-identifier">firewall</span>
</pre>

<h2 id="label-Usage">Usage<span><a href="#label-Usage">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>There are two kinds of firewall rules you can use with Firewall: default
rules and application-specific rules. Default rules apply to general
firewall settings, whereas application-specific rules manage firewall
settings for a specific application, node, etc.</p>

<p>All rules employ a numbering system in the resource&#39;s title that is
used for ordering. When titling your rules, make sure you prefix the rule
with a number, for example, <code>000 accept all icmp requests</code></p>

<pre>  000 runs first
  999 runs last</pre>

<h3 id="label-Default+Rules">Default Rules<span><a href="#label-Default+Rules">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>You can place default rules in either <code>my_fw::pre</code> or
<code>my_fw::post</code>, depending on when you would like them to run.
Rules placed in the <code>pre</code> class will run first, and rules in the
<code>post</code> class, last.</p>

<p>In iptables, the title of the rule is stored using the comment feature of
the underlying firewall subsystem. Values must match &#39;/^<a
href=“:alpha:”>d+[</a>[:<a href=":punct:">digit:]</a>[:space:]]+$/&#39;.</p>

<h4 id="label-Examples+of+Default+Rules">Examples of Default Rules<span><a href="#label-Examples+of+Default+Rules">&para;</a> <a href="#documentation">&uarr;</a></span></h4>

<p>Basic accept ICMP request example:</p>

<pre class="ruby"><span class="ruby-identifier">firewall</span> { <span class="ruby-string">&quot;000 accept all icmp requests&quot;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">proto</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;icmp&quot;</span>,
  <span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;accept&quot;</span>,
}
</pre>

<p>Drop all:</p>

<pre class="ruby"><span class="ruby-identifier">firewall</span> { <span class="ruby-string">&quot;999 drop all other requests&quot;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;drop&quot;</span>,
}
</pre>

<h3 id="label-Application-Specific+Rules">Application-Specific Rules<span><a href="#label-Application-Specific+Rules">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Puppet doesn&#39;t care where you define rules, and this means that you can
place your firewall resources as close to the applications and services
that you manage as you wish. If you use the <a
href="https://puppetlabs.com/learn/roles-profiles-introduction">roles and
profiles pattern</a> then it makes sense to create your firewall rules in
the profiles, so that they remain close to the services managed by the
profile.</p>

<p>This is an example of firewall rules in a profile:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-identifier">profile</span><span class="ruby-operator">::</span><span class="ruby-identifier">apache</span> {
  <span class="ruby-identifier">include</span> <span class="ruby-identifier">apache</span>
  <span class="ruby-identifier">apache</span><span class="ruby-operator">::</span><span class="ruby-identifier">vhost</span> { <span class="ruby-string">&#39;mysite&#39;</span><span class="ruby-operator">:</span> <span class="ruby-keyword">ensure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">present</span> }

  <span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;100 allow http and https access&#39;</span><span class="ruby-operator">:</span>
    <span class="ruby-identifier">port</span>   =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">80</span>, <span class="ruby-value">443</span>],
    <span class="ruby-identifier">proto</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tcp</span>,
    <span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">accept</span>,
  }
}
</pre>

<h3 id="label-Rule+inversion">Rule inversion<span><a href="#label-Rule+inversion">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Firewall rules may be inverted by prefixing the value of a parameter by “!
”. If the value is an array, then every item in the array must be prefixed
as iptables does not understand inverting a single value.</p>

<p>Parameters that understand inversion are: connmark, ctstate, destination,
dport, dst_range, dst_type, port, proto, source, sport, src_range,
src_type, and state.</p>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;001 disallow esp protocol&#39;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;accept&#39;</span>,
  <span class="ruby-identifier">proto</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;! esp&#39;</span>,
}
<span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;002 drop NEW external website packets with FIN/RST/ACK set and SYN unset&#39;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">chain</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;INPUT&#39;</span>,
  <span class="ruby-identifier">state</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;NEW&#39;</span>,
  <span class="ruby-identifier">action</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;drop&#39;</span>,
  <span class="ruby-identifier">proto</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tcp&#39;</span>,
  <span class="ruby-identifier">sport</span>     =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;! http&#39;</span>, <span class="ruby-string">&#39;! 443&#39;</span>],
  <span class="ruby-identifier">source</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;! 10.0.0.0/8&#39;</span>,
  <span class="ruby-identifier">tcp_flags</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;! FIN,SYN,RST,ACK SYN&#39;</span>,
}
</pre>

<h3 id="label-Additional+Uses+for+the+Firewall+Module">Additional Uses for the Firewall Module<span><a href="#label-Additional+Uses+for+the+Firewall+Module">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>You can apply firewall rules to specific nodes. Usually, you will want to
put the firewall rule in another class and apply that class to a node.
Apply a rule to a node as follows:</p>

<pre class="ruby"><span class="ruby-identifier">node</span> <span class="ruby-string">&#39;some.node.com&#39;</span> {
  <span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;111 open port 111&#39;</span><span class="ruby-operator">:</span>
    <span class="ruby-identifier">dport</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">111</span>
  }
}
</pre>

<p>You can also do more complex things with the <code>firewall</code>
resource. This example sets up static NAT for the source network
10.1.2.0/24:</p>

<pre class="ruby"><span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;100 snat for network foo2&#39;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">chain</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;POSTROUTING&#39;</span>,
  <span class="ruby-identifier">jump</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;MASQUERADE&#39;</span>,
  <span class="ruby-identifier">proto</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;all&#39;</span>,
  <span class="ruby-identifier">outiface</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;eth0&quot;</span>,
  <span class="ruby-identifier">source</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;10.1.2.0/24&#39;</span>,
  <span class="ruby-identifier">table</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;nat&#39;</span>,
}
</pre>

<p>The following example creates a new chain and forwards any port 5000 access
to it.</p>

<pre class="ruby"><span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;100 forward to MY_CHAIN&#39;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">chain</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;INPUT&#39;</span>,
  <span class="ruby-identifier">jump</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;MY_CHAIN&#39;</span>,
}
<span class="ruby-comment"># The namevar here is in the format chain_name:table:protocol</span>
<span class="ruby-identifier">firewallchain</span> { <span class="ruby-string">&#39;MY_CHAIN:filter:IPv4&#39;</span><span class="ruby-operator">:</span>
  <span class="ruby-keyword">ensure</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">present</span>,
}
<span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;100 my rule&#39;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">chain</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;MY_CHAIN&#39;</span>,
  <span class="ruby-identifier">action</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;accept&#39;</span>,
  <span class="ruby-identifier">proto</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tcp&#39;</span>,
  <span class="ruby-identifier">dport</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5000</span>,
}
</pre>

<h3 id="label-Additional+Information">Additional Information<span><a href="#label-Additional+Information">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Access the inline documentation:</p>

<pre>puppet describe firewall</pre>

<p>Or</p>

<pre>puppet doc -r type
(and search for firewall)</pre>

<h2 id="label-Reference">Reference<span><a href="#label-Reference">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Classes:</p>
<ul><li>
<p><a href="#class-firewall">firewall</a></p>
</li></ul>

<p>Types:</p>
<ul><li>
<p><a href="#type-firewall">firewall</a></p>
</li><li>
<p><a href="#type-firewallchain">firewallchain</a></p>
</li></ul>

<p>Facts:</p>
<ul><li>
<p><a href="#fact-ip6tablesversion">ip6tables_version</a></p>
</li><li>
<p><a href="#fact-iptablesversion">iptables_version</a></p>
</li><li>
<p><a href="#fact-iptablespersistentversion">iptables_persistent_version</a></p>
</li></ul>

<h3 id="label-Class%3A+firewall">Class: firewall<span><a href="#label-Class%3A+firewall">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Performs the basic setup tasks required for using the firewall resources.</p>

<p>At the moment this takes care of:</p>
<ul><li>
<p>iptables-persistent package installation</p>
</li></ul>

<p>Include the <code>firewall</code> class for nodes that need to use the
resources in this module:</p>

<pre class="ruby"><span class="ruby-identifier">class</span> { <span class="ruby-string">&#39;firewall&#39;</span><span class="ruby-operator">:</span> }
</pre>

<h4 id="label-ensure"><code>ensure</code><span><a href="#label-ensure">&para;</a> <a href="#documentation">&uarr;</a></span></h4>

<p>Parameter that controls the state of the <code>iptables</code> service on
your system, allowing you to disable <code>iptables</code> if you want.</p>

<p><code>ensure</code> can either be <code>running</code> or
<code>stopped</code>. Default to <code>running</code>.</p>

<h3 id="label-Type%3A+firewall">Type: firewall<span><a href="#label-Type%3A+firewall">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>This type enables you to manage firewall rules within Puppet.</p>

<h4 id="label-Providers">Providers<span><a href="#label-Providers">&para;</a> <a href="#documentation">&uarr;</a></span></h4>

<p><strong>Note:</strong> Not all features are available with all providers.</p>
<ul><li>
<p><code>ip6tables</code>: Ip6tables type provider</p>
<ul><li>
<p>Required binaries: <code>ip6tables-save</code>, <code>ip6tables</code>.</p>
</li><li>
<p>Supported features: <code>connection_limiting</code>, <code>dnat</code>,
<code>hop_limiting</code>, <code>icmp_match</code>,
<code>interface_match</code>, <code>iptables</code>,
<code>isfirstfrag</code>, <code>ishasmorefrags</code>,
<code>islastfrag</code>, <code>log_level</code>, <code>log_prefix</code>,
<code>mark</code>, <code>owner</code>, <code>pkttype</code>,
<code>rate_limiting</code>, <code>recent_limiting</code>,
<code>reject_type</code>, <code>snat</code>, <code>state_match</code>,
<code>tcp_flags</code>.</p>
</li><li>
<p>Required binaries: <code>ip6tables-save</code>, <code>ip6tables</code>.</p>
</li><li>
<p>Supported features: <code>connection_limiting</code>, <code>dnat</code>,
<code>hop_limiting</code>, <code>icmp_match</code>,
<code>interface_match</code>, <code>iptables</code>,
<code>isfirstfrag</code>, <code>ishasmorefrags</code>,
<code>islastfrag</code>, <code>log_level</code>, <code>log_prefix</code>,
<code>mark</code>, <code>owner</code>, <code>pkttype</code>,
<code>rate_limiting</code>, <code>recent_limiting</code>,
<code>reject_type</code>, <code>snat</code>, <code>state_match</code>,
<code>tcp_flags</code>.</p>
</li></ul>
</li><li>
<p><code>iptables</code>: Iptables type provider</p>
<ul><li>
<p>Required binaries: <code>iptables-save</code>, <code>iptables</code>.</p>
</li><li>
<p>Default for <code>kernel</code> == <code>linux</code>.</p>
</li><li>
<p>Supported features: <code>address_type</code>,
<code>connection_limiting</code>, <code>dnat</code>,
<code>icmp_match</code>, <code>interface_match</code>,
<code>iprange</code>, <code>ipsec_dir</code>, <code>ipsec_policy</code>,
<code>iptables</code>, <code>isfragment</code>, <code>log_level</code>,
<code>log_prefix</code>, <code>mark</code>, <code>owner</code>,
<code>pkttype</code>, <code>rate_limiting</code>,
<code>recent_limiting</code>, <code>reject_type</code>, <code>snat</code>,
<code>socket</code>, <code>state_match</code>, <code>tcp_flags</code>.</p>
</li></ul>
</li></ul>

<p><strong>Autorequires:</strong></p>

<p>If Puppet is managing the iptables or ip6tables chains specified in the
<code>chain</code> or <code>jump</code> parameters, the firewall resource
will autorequire those firewallchain resources.</p>

<p>If Puppet is managing the iptables or iptables-persistent packages, and the
provider is iptables or ip6tables, the firewall resource will autorequire
those packages to ensure that any required binaries are installed.</p>

<h4 id="label-Features">Features<span><a href="#label-Features">&para;</a> <a href="#documentation">&uarr;</a></span></h4>
<ul><li>
<p><code>address_type</code>: The ability to match on source or destination
address type.</p>
</li><li>
<p><code>connection_limiting</code>: Connection limiting features.</p>
</li><li>
<p><code>dnat</code>: Destination NATing.</p>
</li><li>
<p><code>hop_limiting</code>: Hop limiting features.</p>
</li><li>
<p><code>icmp_match</code>: The ability to match ICMP types.</p>
</li><li>
<p><code>interface_match</code>: Interface matching.</p>
</li><li>
<p><code>iprange</code>: The ability to match on source or destination IP
range.</p>
</li><li>
<p><code>ipsec_dir</code>: The ability to match IPsec policy direction.</p>
</li><li>
<p><code>ipsec_policy</code>: The ability to match IPsec policy.</p>
</li><li>
<p><code>iptables</code>: The provider provides iptables features.</p>
</li><li>
<p><code>isfirstfrag</code>: The ability to match the first fragment of a
fragmented ipv6 packet.</p>
</li><li>
<p><code>isfragment</code>: The ability to match fragments.</p>
</li><li>
<p><code>ishasmorefrags</code>: The ability to match a non-last fragment of a
fragmented ipv6 packet.</p>
</li><li>
<p><code>islastfrag</code>: The ability to match the last fragment of an ipv6
packet.</p>
</li><li>
<p><code>log_level</code>: The ability to control the log level.</p>
</li><li>
<p><code>log_prefix</code>: The ability to add prefixes to log messages.</p>
</li><li>
<p><code>mark</code>: The ability to match or set the netfilter mark value
associated with the packet.</p>
</li><li>
<p><code>mask</code>: The ability to match recent rules based on the ipv4
mask.</p>
</li><li>
<p><code>owner</code>: The ability to match owners.</p>
</li><li>
<p><code>pkttype</code>: The ability to match a packet type.</p>
</li><li>
<p><code>rate_limiting</code>: Rate limiting features.</p>
</li><li>
<p><code>recent_limiting</code>: The netfilter recent module.</p>
</li><li>
<p><code>reject_type</code>: The ability to control reject messages.</p>
</li><li>
<p><code>snat</code>: Source NATing.</p>
</li><li>
<p><code>socket</code>: The ability to match open sockets.</p>
</li><li>
<p><code>state_match</code>: The ability to match stateful firewall states.</p>
</li><li>
<p><code>tcp_flags</code>: The ability to match on particular TCP flag
settings.</p>
</li></ul>

<h4 id="label-Parameters">Parameters<span><a href="#label-Parameters">&para;</a> <a href="#documentation">&uarr;</a></span></h4>
<ul><li>
<p><code>action</code>: This is the action to perform on a match. Valid values
for this action are:</p>
</li><li>
<p>&#39;accept&#39;: The packet is accepted.</p>
</li><li>
<p>&#39;reject&#39;: The packet is rejected with a suitable ICMP response.</p>
</li><li>
<p>&#39;drop&#39;: The packet is dropped.</p>
</li></ul>

<p>If you specify no value it will simply match the rule but perform no action
unless you provide a provider-specific parameter (such as
<code>jump</code>).</p>
<ul><li>
<p><code>burst</code>: Rate limiting burst value (per second) before limit
checks apply. Values must match &#39;/^d+$/&#39;. Requires the
<code>rate_limiting</code> feature.</p>
</li><li>
<p><code>chain</code>: Name of the chain to use. You can provide a user-based
chain or use one of the following built-in
chains:&#39;INPUT&#39;,&#39;FORWARD&#39;,&#39;OUTPUT&#39;,&#39;PREROUTING&#39;,
or &#39;POSTROUTING&#39;. The default value is &#39;INPUT&#39;. Values must
match &#39;/<a id="footmark-1" href="#foottext-1">*1</a> Requires the
<code>iptables</code> feature.</p>
</li><li>
<p><code>connlimit_above</code>: Connection limiting value for matched
connections above n. Values must match &#39;/^d+$/&#39;. Requires the
<code>connection_limiting</code> feature.</p>
</li><li>
<p><code>connlimit_mask</code>: Connection limiting by subnet mask for matched
connections. Apply a subnet mask of /0 to /32 for IPv4, and a subnet mask
of /0 to /128 for IPv6. Values must match &#39;/^d+$/&#39;. Requires the
<code>connection_limiting</code> feature.</p>
</li><li>
<p><code>connmark</code>: Match the Netfilter mark value associated with the
packet. Accepts values <code>mark/mask</code> or <code>mark</code>. These
will be converted to hex if they are not hex already. Requires the
<code>mark</code> feature.</p>
</li><li>
<p><code>ctstate</code>: Matches a packet based on its state in the firewall
stateful inspection table, using the conntrack module. Valid values are:
&#39;INVALID&#39;, &#39;ESTABLISHED&#39;, &#39;NEW&#39;, &#39;RELATED&#39;.
Requires the <code>state_match</code> feature.</p>
</li><li>
<p><code>destination</code>: The destination address to match. For example:
<code>destination =&gt; &#39;192.168.1.0/24&#39;</code>. You can also
negate a mask by putting ! in front. For example: <code>destination  =&gt;
&#39;! 192.168.2.0/24&#39;</code>. The destination can also be an IPv6
address if your provider supports it.</p>
</li></ul>

<p>For some firewall providers you can pass a range of ports in the format:
&#39;start number-end number&#39;. For example, &#39;1-1024&#39; would
cover ports 1 to 1024.</p>
<ul><li>
<p><code>dport</code>: The destination port to match for this filter (if the
protocol supports ports). Will accept a single element or an array. For
some firewall providers you can pass a range of ports in the format:
&#39;start number-end number&#39;. For example, &#39;1-1024&#39; would
cover ports 1 to 1024.</p>
</li><li>
<p><code>dst_range</code>: The destination IP range. For example:
<code>dst_range =&gt; &#39;192.168.1.1-192.168.1.10&#39;</code>.</p>
</li></ul>

<p>The destination IP range is must in &#39;IP1-IP2&#39; format. Values must
match &#39;0.0.0.0-0.0.0.0&#39; through
&#39;255.255.255.255-255.255.255.255&#39;. Requires the
<code>iprange</code> feature.</p>
<ul><li>
<p><code>dst_type</code>: The destination address type. For example:
<code>dst_type =&gt; &#39;LOCAL&#39;</code>.</p>
</li></ul>

<p>Valid values are:</p>
<ul><li>
<p>&#39;UNSPEC&#39;: an unspecified address</p>
</li><li>
<p>&#39;UNICAST&#39;: a unicast address</p>
</li><li>
<p>&#39;LOCAL&#39;: a local address</p>
</li><li>
<p>&#39;BROADCAST&#39;: a broadcast address</p>
</li><li>
<p>&#39;ANYCAST&#39;: an anycast packet</p>
</li><li>
<p>&#39;MULTICAST&#39;: a multicast address</p>
</li><li>
<p>&#39;BLACKHOLE&#39;: a blackhole address</p>
</li><li>
<p>&#39;UNREACHABLE&#39;: an unreachable address</p>
</li><li>
<p>&#39;PROHIBIT&#39;: a prohibited address</p>
</li><li>
<p>&#39;THROW&#39;: an unroutable address</p>
</li><li>
<p>&#39;XRESOLVE: an unresolvable address</p>
</li></ul>

<p>Requires the <code>address_type</code> feature.</p>
<ul><li>
<p><code>ensure</code>: Ensures that the resource is present. Valid values are
&#39;present&#39;, &#39;absent&#39;. The default is &#39;present&#39;.</p>
</li><li>
<p><code>gid</code>: GID or Group owner matching rule. Accepts a string
argument only, as iptables does not accept multiple gid in a single
statement. Requires the <code>owner</code> feature.</p>
</li><li>
<p><code>hop_limit</code>: Hop limiting value for matched packets. Values must
match &#39;/^d+$/&#39;. Requires the <code>hop_limiting</code> feature.</p>
</li><li>
<p><code>icmp</code>: When matching ICMP packets, this indicates the type of
ICMP packet to match. A value of &#39;any&#39; is not supported. To match
any type of ICMP packet, the parameter should be omitted or undefined.
Requires the <code>icmp_match</code> feature.</p>
</li><li>
<p><code>iniface</code>: Input interface to filter on. Values must match
&#39;/<a id="footmark-2" href="#foottext-2">*2</a> Requires the
<code>interface_match</code> feature.</p>
</li><li>
<p><code>ipsec_dir</code>: Sets the ipsec policy direction. Valid values are
&#39;in&#39;, &#39;out&#39;. Requires the <code>ipsec_dir</code> feature.</p>
</li><li>
<p><code>ipsec_policy</code>: Sets the ipsec policy type. Valid values are
&#39;none&#39;, &#39;ipsec&#39;. Requires the <code>ipsec_policy</code>
feature.</p>
</li><li>
<p><code>ipset</code>: Matches IP sets. Value must be <code>ipset_name
(src|dst|src,dst)</code> and can be negated by putting ! in front. Requires
ipset kernel module.</p>
</li><li>
<p><code>isfirstfrag</code>: If true, matches when the packet is the first
fragment of a fragmented ipv6 packet. Cannot be negated. Supported by ipv6
only. Valid values are &#39;true&#39;, &#39;false&#39;. Requires the
<code>isfirstfrag</code> feature.</p>
</li><li>
<p><code>isfragment</code>: If &#39;true&#39;, matches when the packet is a
tcp fragment of a fragmented packet. Supported by iptables only. Valid
values are &#39;true&#39;, &#39;false&#39;. Requires features
<code>isfragment</code>.</p>
</li><li>
<p><code>ishasmorefrags</code>: If &#39;true&#39;, matches when the packet has
the &#39;more fragments&#39; bit set. Supported by ipv6 only. Valid values
are &#39;true&#39;, &#39;false&#39;. Requires the
<code>ishasmorefrags</code> feature.</p>
</li><li>
<p><code>islastfrag</code>: If true, matches when the packet is the last
fragment of a fragmented ipv6 packet. Supported by ipv6 only. Valid values
are &#39;true&#39;, &#39;false&#39;. Requires the <code>islastfrag</code>.</p>
</li><li>
<p><code>jump</code>: The value for the iptables <code>--jump</code>
parameter. Any valid chain name is allowed, but normal values are:
&#39;QUEUE&#39;, &#39;RETURN&#39;, &#39;DNAT&#39;, &#39;SNAT&#39;,
&#39;LOG&#39;, &#39;MASQUERADE&#39;, &#39;REDIRECT&#39;, &#39;MARK&#39;.</p>
</li></ul>

<p>For the values &#39;ACCEPT&#39;, &#39;DROP&#39;, and &#39;REJECT&#39;, you
must use the generic <code>action</code> parameter. This is to enforce the
use of generic parameters where possible for maximum cross-platform
modeling.</p>

<p>If you set both <code>accept</code> and <code>jump</code> parameters, you
will get an error, because only one of the options should be set. Requires
the <code>iptables</code> feature.</p>
<ul><li>
<p><code>limit</code>: Rate limiting value for matched packets. The format is:
&#39;<a href="http:///second/|/minute|/hour|/day">rate/</a>&#39;. Example
values are: &#39;50/sec&#39;, &#39;40/min&#39;, &#39;30/hour&#39;,
&#39;10/day&#39;. Requires the <code>rate_limiting</code> feature.</p>
</li><li>
<p><code>line</code>: Read-only property for caching the rule line.</p>
</li><li>
<p><code>log_level</code>: When combined with <code>jump =&gt;
&#39;LOG&#39;</code> specifies the system log level to log to. Requires the
<code>log_level</code> feature.</p>
</li><li>
<p><code>log_prefix</code>: When combined with <code>jump =&gt;
&#39;LOG&#39;</code> specifies the log prefix to use when logging. Requires
the <code>log_prefix</code> feature.</p>
</li><li>
<p><code>mask</code>: Sets the mask to use when <code>recent</code> is
enabled. Requires the <code>mask</code> feature.</p>
</li><li>
<p><code>name</code>: The canonical name of the rule. This name is also used
for ordering, so make sure you prefix the rule with a number. For example:</p>
</li></ul>

<pre>firewall { &#39;000 this runs first&#39;:
  # this rule will run first
}
firewall { &#39;999 this runs last&#39;:
  # this rule will run last
}</pre>

<p>Depending on the provider, the name of the rule can be stored using the
comment feature of the underlying firewall subsystem. Values must match
&#39;/^<a href=“:alpha:”>d+[</a>[:<a
href=":punct:">digit:]</a>[:space:]]+$/&#39;.</p>
<ul><li>
<p><code>outiface</code>: Output interface to filter on. Values must match
&#39;/<a id="footmark-4" href="#foottext-4">*4</a> Requires the
<code>interface_match</code> feature.</p>
</li><li>
<p><code>pkttype</code>: Sets the packet type to match. Valid values are:
&#39;unicast&#39;, &#39;broadcast&#39;, and&#39;multicast&#39;. Requires
the <code>pkttype</code> feature.</p>
</li><li>
<p><code>port</code>: The destination or source port to match for this filter
(if the protocol supports ports). Will accept a single element or an array.
For some firewall providers you can pass a range of ports in the format:
&#39;start number-end number&#39;. For example, &#39;1-1024&#39; would
cover ports 1 to 1024.</p>
</li><li>
<p><code>proto</code>: The specific protocol to match for this rule. This is
&#39;tcp&#39; by default. Valid values are:</p>
</li><li>
<p>&#39;tcp&#39;</p>
</li><li>
<p>&#39;udp&#39;</p>
</li><li>
<p>&#39;icmp&#39;</p>
</li><li>
<p>&#39;ipv6-icmp&#39;</p>
</li><li>
<p>&#39;esp&#39;</p>
</li><li>
<p>&#39;ah&#39;</p>
</li><li>
<p>&#39;vrrp&#39;</p>
</li><li>
<p>&#39;igmp&#39;</p>
</li><li>
<p>&#39;ipencap&#39;</p>
</li><li>
<p>&#39;ospf&#39;</p>
</li><li>
<p>&#39;gre&#39;</p>
</li><li>
<p>&#39;all&#39;</p>
</li><li>
<p><code>provider</code>: The specific backend to use for this firewall
resource. You will seldom need to specify this — Puppet will usually
discover the appropriate provider for your platform. Available providers
are ip6tables and iptables. See the <a href="#providers">Providers</a>
section above for details about these providers.</p>
</li><li>
<p><code>random</code>: When using a <code>jump</code> value of
&#39;MASQUERADE&#39;, &#39;DNAT&#39;, &#39;REDIRECT&#39;, or
&#39;SNAT&#39;, this boolean will enable randomized port mapping. Valid
values are &#39;true&#39;, &#39;false&#39;. Requires the <code>dnat</code>
feature.</p>
</li><li>
<p><code>rdest</code>: If boolean &#39;true&#39;, adds the destination IP
address to the list. Valid values are &#39;true&#39;, &#39;false&#39;.
Requires the <code>recent_limiting</code> feature and the
<code>recent</code> parameter.</p>
</li><li>
<p><code>reap</code>: Can only be used in conjunction with the
<code>rseconds</code> parameter. If boolean &#39;true&#39;, this will purge
entries older than &#39;seconds&#39; as specified in <code>rseconds</code>.
Valid values are &#39;true&#39;, &#39;false&#39;. Requires the
<code>recent_limiting</code> feature and the <code>recent</code> parameter.</p>
</li><li>
<p><code>recent</code>: Enable the recent module. Valid values are:
&#39;set&#39;, &#39;update&#39;, &#39;rcheck&#39;, or &#39;remove&#39;. For
example:</p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># If anyone&#39;s appeared on the &#39;badguy&#39; blacklist within</span>
<span class="ruby-comment"># the last 60 seconds, drop their traffic, and update the timestamp.</span>
<span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;100 Drop badguy traffic&#39;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">recent</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;update&#39;</span>,
  <span class="ruby-identifier">rseconds</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">60</span>,
  <span class="ruby-identifier">rsource</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>,
  <span class="ruby-identifier">rname</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;badguy&#39;</span>,
  <span class="ruby-identifier">action</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;DROP&#39;</span>,
  <span class="ruby-identifier">chain</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;FORWARD&#39;</span>,
}
<span class="ruby-comment"># No-one should be sending us traffic on eth0 from localhost</span>
<span class="ruby-comment"># Blacklist them</span>
<span class="ruby-identifier">firewall</span> { <span class="ruby-string">&#39;101 blacklist strange traffic&#39;</span><span class="ruby-operator">:</span>
  <span class="ruby-identifier">recent</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;set&#39;</span>,
  <span class="ruby-identifier">rsource</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>,
  <span class="ruby-identifier">rname</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;badguy&#39;</span>,
  <span class="ruby-identifier">destination</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;127.0.0.0/8&#39;</span>,
  <span class="ruby-identifier">iniface</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;eth0&#39;</span>,
  <span class="ruby-identifier">action</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;DROP&#39;</span>,
  <span class="ruby-identifier">chain</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;FORWARD&#39;</span>,
}
</pre>

<p>Requires the <code>recent_limiting</code> feature.</p>
<ul><li>
<p><code>reject</code>: When combined with <code>jump =&gt;
&#39;REJECT&#39;</code>, you can specify a different ICMP response to be
sent back to the packet sender. Requires the <code>reject_type</code>
feature.</p>
</li><li>
<p><code>rhitcount</code>: Used in conjunction with <code>recent =&gt;
&#39;update&#39;</code> or <code>recent =&gt; &#39;rcheck&#39;</code>. When
used, this will narrow the match to happen only when the address is in the
list and packets greater than or equal to the given value have been
received. Requires the <code>recent_limiting</code> feature and the
<code>recent</code> parameter.</p>
</li><li>
<p><code>rname</code>: Specify the name of the list. Takes a string argument.
Requires the <code>recent_limiting</code> feature and the
<code>recent</code> parameter.</p>
</li><li>
<p><code>rseconds</code>: Used in conjunction with <code>recent =&gt;
&#39;rcheck&#39;</code> or <code>recent =&gt; &#39;update&#39;</code>. When
used, this will narrow the match to only happen when the address is in the
list and was seen within the last given number of seconds. Requires the
<code>recent_limiting</code> feature and the <code>recent</code> parameter.</p>
</li><li>
<p><code>rsource</code>: If boolean &#39;true&#39;, adds the source IP address
to the list. Valid values are &#39;true&#39;, &#39;false&#39;. Requires the
<code>recent_limiting</code> feature and the <code>recent</code> parameter.</p>
</li><li>
<p><code>rttl</code>: May only be used in conjunction with <code>recent =&gt;
&#39;rcheck&#39;</code> or <code>recent =&gt; &#39;update&#39;</code>. If
boolean &#39;true&#39;, this will narrow the match to happen only when the
address is in the list and the TTL of the current packet matches that of
the packet that hit the <code>recent =&gt; &#39;set&#39;</code> rule. If
you have problems with DoS attacks via bogus packets from fake source
addresses, this parameter may help. Valid values are &#39;true&#39;,
&#39;false&#39;. Requires the <code>recent_limiting</code> feature and the
<code>recent</code> parameter.</p>
</li><li>
<p><code>set_mark</code>: Set the Netfilter mark value associated with the
packet. Accepts either &#39;mark/mask&#39; or &#39;mark&#39;. These will be
converted to hex if they are not already. Requires the <code>mark</code>
feature.</p>
</li><li>
<p><code>socket</code>: If &#39;true&#39;, matches if an open socket can be
found by doing a socket lookup on the packet. Valid values are
&#39;true&#39;, &#39;false&#39;. Requires the <code>socket</code> feature.</p>
</li><li>
<p><code>source</code>: The source address. For example: <code>source =&gt;
&#39;192.168.2.0/24&#39;</code>. You can also negate a mask by putting ! in
front. For example: <code>source =&gt; &#39;! 192.168.2.0/24&#39;</code>.
The source can also be an IPv6 address if your provider supports it.</p>
</li><li>
<p><code>sport</code>: The source port to match for this filter (if the
protocol supports ports). Will accept a single element or an array. For
some firewall providers you can pass a range of ports in the
format:&#39;start number-end number&#39;. For example, &#39;1-1024&#39;
would cover ports 1 to 1024.</p>
</li><li>
<p><code>src_range</code>: The source IP range. For example: <code>src_range
=&gt; &#39;192.168.1.1-192.168.1.10&#39;</code>. The source IP range is
must in &#39;IP1-IP2&#39; format. Values must match
&#39;0.0.0.0-0.0.0.0&#39; through
&#39;255.255.255.255-255.255.255.255&#39;. Requires the
<code>iprange</code> feature.</p>
</li><li>
<p><code>src_type</code>: Specify the source address type. For example:
<code>src_type =&gt; &#39;LOCAL&#39;</code>.</p>
</li></ul>

<p>Valid values are:</p>
<ul><li>
<p>&#39;UNSPEC&#39;: an unspecified address.</p>
</li><li>
<p>&#39;UNICAST&#39;: a unicast address.</p>
</li><li>
<p>&#39;LOCAL&#39;: a local address.</p>
</li><li>
<p>&#39;BROADCAST&#39;: a broadcast address.</p>
</li><li>
<p>&#39;ANYCAST&#39;: an anycast packet.</p>
</li><li>
<p>&#39;MULTICAST&#39;: a multicast address.</p>
</li><li>
<p>&#39;BLACKHOLE&#39;: a blackhole address.</p>
</li><li>
<p>&#39;UNREACHABLE&#39;: an unreachable address.</p>
</li><li>
<p>&#39;PROHIBIT&#39;: a prohibited address.</p>
</li><li>
<p>&#39;THROW&#39;: an unroutable address.</p>
</li><li>
<p>&#39;XRESOLVE&#39;: an unresolvable address.</p>
</li></ul>

<p>Requires the <code>address_type</code> feature.</p>
<ul><li>
<p><code>stat_every</code>: Match one packet every nth packet. Requires
<code>stat_mode =&gt; &#39;nth&#39;</code></p>
</li><li>
<p><code>stat_mode</code>: Set the matching mode for statistic matching.
Supported modes are <code>random</code> and <code>nth</code>.</p>
</li><li>
<p><code>stat_packet</code>: Set the initial counter value for the nth mode.
Must be between 0 and the value of <code>stat_every</code>. Defaults to 0.
Requires <code>stat_mode =&gt; &#39;nth&#39;</code></p>
</li><li>
<p><code>stat_probability</code>: Set the probability from 0 to 1 for a packet
to be randomly matched. It works only with <code>stat_mode =&gt;
&#39;random&#39;</code>.</p>
</li><li>
<p><code>state</code>: Matches a packet based on its state in the firewall
stateful inspection table. Valid values are: &#39;INVALID&#39;,
&#39;ESTABLISHED&#39;, &#39;NEW&#39;, &#39;RELATED&#39;. Requires the
<code>state_match</code> feature.</p>
</li><li>
<p><code>table</code>: Table to use. Valid values are: &#39;nat&#39;,
&#39;mangle&#39;, &#39;filter&#39;, &#39;raw&#39;, &#39;rawpost&#39;. By
default the setting is &#39;filter&#39;. Requires the <code>iptables</code>
feature.</p>
</li><li>
<p><code>tcp_flags</code>: Match when the TCP flags are as specified. Set as a
string with a list of comma-separated flag names for the mask, then a
space, then a comma-separated list of flags that should be set. The flags
are: &#39;SYN&#39;, &#39;ACK&#39;, &#39;FIN&#39;, &#39;RST&#39;,
&#39;URG&#39;, &#39;PSH&#39;, &#39;ALL&#39;, &#39;NONE&#39;.</p>
</li></ul>

<p>Note that you specify flags in the order that iptables <code>--list</code>
rules would list them to avoid having Puppet think you changed the flags.
For example, &#39;FIN,SYN,RST,ACK SYN&#39; matches packets with the SYN bit
set and the ACK, RST and FIN bits cleared. Such packets are used to request
TCP connection initiation. Requires the <code>tcp_flags</code> feature.</p>
<ul><li>
<p><code>todest</code>: When using <code>jump =&gt; &#39;DNAT&#39;</code>, you
can specify the new destination address using this parameter. Requires the
<code>dnat</code> feature.</p>
</li><li>
<p><code>toports</code>: For DNAT this is the port that will replace the
destination port. Requires the <code>dnat</code> feature.</p>
</li><li>
<p><code>tosource</code>: When using <code>jump =&gt; &#39;SNAT&#39;</code>,
you can specify the new source address using this parameter. Requires the
<code>snat</code> feature.</p>
</li><li>
<p><code>uid</code>: UID or Username owner matching rule. Accepts a string
argument only, as iptables does not accept multiple uid in a single
statement. Requires the <code>owner</code> feature.</p>
</li></ul>

<h3 id="label-Type%3A+firewallchain">Type: firewallchain<span><a href="#label-Type%3A+firewallchain">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Enables you to manage rule chains for firewalls.</p>

<p>Currently this type supports only iptables, ip6tables, and ebtables on
Linux. It also provides support for setting the default policy on chains
and tables that allow it.</p>

<p><strong>Autorequires</strong>: If Puppet is managing the iptables or
iptables-persistent packages, and the provider is iptables_chain, the
firewall resource will autorequire those packages to ensure that any
required binaries are installed.</p>

<h4 id="label-Providers">Providers<span><a href="#label-Providers">&para;</a> <a href="#documentation">&uarr;</a></span></h4>

<p><code>iptables_chain</code> is the only provider that supports
firewallchain.</p>

<h4 id="label-Features">Features<span><a href="#label-Features">&para;</a> <a href="#documentation">&uarr;</a></span></h4>
<ul><li>
<p><code>iptables_chain</code>: The provider provides iptables chain features.</p>
</li><li>
<p><code>policy</code>: Default policy (inbuilt chains only).</p>
</li></ul>

<h4 id="label-Parameters">Parameters<span><a href="#label-Parameters">&para;</a> <a href="#documentation">&uarr;</a></span></h4>
<ul><li>
<p><code>ensure</code>: Ensures that the resource is present. Valid values are
&#39;present&#39;, &#39;absent&#39;.</p>
</li><li>
<p><code>ignore</code>: Regex to perform on firewall rules to exempt unmanaged
rules from purging (when enabled). This is matched against the output of
iptables-save. This can be a single regex or an array of them. To support
flags, use the ruby inline flag mechanism: a regex such as
<code>/foo/i</code> can be written as <code>(?i)foo</code> or
<code>(?i:foo)</code>. Only when purge is &#39;true&#39;.</p>
</li></ul>

<p>Full example:</p>

<pre class="ruby">  <span class="ruby-identifier">firewallchain</span> { <span class="ruby-string">&#39;INPUT:filter:IPv4&#39;</span><span class="ruby-operator">:</span> 
    <span class="ruby-identifier">purge</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, 
    <span class="ruby-identifier">ignore</span> =<span class="ruby-operator">&gt;</span> [
       <span class="ruby-comment"># ignore the fail2ban jump rule</span>
       <span class="ruby-string">&#39;-j fail2ban-ssh&#39;</span>, 
       <span class="ruby-comment"># ignore any rules with &quot;ignore&quot; (case insensitive) in the comment in the rule </span>
       <span class="ruby-string">&#39;--comment &quot;[^&quot;](?i:ignore)[^&quot;]&quot;&#39;</span>, 
     ],
  }
</pre>
<ul><li>
<p><code>name</code>: Specify the canonical name of the chain. For iptables
the format must be {chain}:{table}:{protocol}.</p>
</li><li>
<p><code>policy</code>: Set the action the packet will perform when the end of
the chain is reached. It can only be set on inbuilt chains
(&#39;INPUT&#39;, &#39;FORWARD&#39;, &#39;OUTPUT&#39;,
&#39;PREROUTING&#39;, &#39;POSTROUTING&#39;). Valid values are:</p>
</li><li>
<p>&#39;accept&#39;: The packet is accepted.</p>
</li><li>
<p>&#39;drop&#39;: The packet is dropped.</p>
</li><li>
<p>&#39;queue&#39;: The packet is passed userspace.</p>
</li><li>
<p>&#39;return&#39;: The packet is returned to calling (jump) queue or to the
default of inbuilt chains.</p>
</li><li>
<p><code>provider</code>: The specific backend to use for this firewallchain
resource. You will seldom need to specify this — Puppet will usually
discover the appropriate provider for your platform. The only available
provider is:</p>
</li></ul>

<p><code>iptables_chain</code>: iptables chain provider</p>

<pre>* Required binaries: `ebtables-save`, `ebtables`, `ip6tables-save`, `ip6tables`, `iptables-save`, `iptables`.
* Default for `kernel` == `linux`.
* Supported features: `iptables_chain`, `policy`.</pre>
<ul><li>
<p><code>purge</code>: Purge unmanaged firewall rules in this chain. Valid
values are &#39;false&#39;, &#39;true&#39;.</p>
</li></ul>

<h3 id="label-Fact%3A+ip6tables_version">Fact: ip6tables_version<span><a href="#label-Fact%3A+ip6tables_version">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>A Facter fact that can be used to determine what the default version of
ip6tables is for your operating system/distribution.</p>

<h3 id="label-Fact%3A+iptables_version">Fact: iptables_version<span><a href="#label-Fact%3A+iptables_version">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>A Facter fact that can be used to determine what the default version of
iptables is for your operating system/distribution.</p>

<h3 id="label-Fact%3A+iptables_persistent_version">Fact: iptables_persistent_version<span><a href="#label-Fact%3A+iptables_persistent_version">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Retrieves the version of iptables-persistent from your OS. This is a
Debian/Ubuntu specific fact.</p>

<h2 id="label-Limitations">Limitations<span><a href="#label-Limitations">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<h3 id="label-SLES">SLES<span><a href="#label-SLES">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>The <code>socket</code> parameter is not supported on SLES. In this release
it will cause the catalog to fail with iptables failures, rather than
correctly warn you that the features are unusable.</p>

<h3 id="label-Oracle+Enterprise+Linux">Oracle Enterprise Linux<span><a href="#label-Oracle+Enterprise+Linux">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>The <code>socket</code> and <code>owner</code> parameters are unsupported
on Oracle Enterprise Linux when the “Unbreakable” kernel is used. These may
function correctly when using the stock RedHat kernel instead. Declaring
either of these parameters on an unsupported system will result in iptable
rules failing to apply.</p>

<h3 id="label-Other">Other<span><a href="#label-Other">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Bugs can be reported using JIRA issues</p>

<p><a href="http://tickets.puppetlabs.com">tickets.puppetlabs.com</a></p>

<h2 id="label-Development">Development<span><a href="#label-Development">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Puppet Labs modules on the Puppet Forge are open projects, and community
contributions are essential for keeping them great. We can’t access the
huge number of platforms and myriad of hardware, software, and deployment
configurations that Puppet is intended to serve.</p>

<p>We want to keep it as easy as possible to contribute changes so that our
modules work in your environment. There are a few guidelines that we need
contributors to follow so that we can have a chance of keeping on top of
things.</p>

<p>You can read the complete module contribution guide <a
href="http://projects.puppetlabs.com/projects/module-site/wiki/Module_contributing">on
the Puppet Labs wiki.</a></p>

<p>For this particular module, please also read CONTRIBUTING.md before
contributing.</p>

<p>Currently we support:</p>
<ul><li>
<p>iptables</p>
</li><li>
<p>ip6tables</p>
</li><li>
<p>ebtables (chains only)</p>
</li></ul>

<h3 id="label-Testing">Testing<span><a href="#label-Testing">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Make sure you have:</p>
<ul><li>
<p>rake</p>
</li><li>
<p>bundler</p>
</li></ul>

<p>Install the necessary gems:</p>

<pre>bundle install</pre>

<p>And run the tests from the root of the source code:</p>

<pre>rake test</pre>

<p>If you have a copy of Vagrant 1.1.0 you can also run the system tests:</p>

<pre>RS_SET=ubuntu-1404-x64 rspec spec/acceptance
RS_SET=centos-64-x64 rspec spec/acceptance</pre>
<hr style="height: 1px">

<p><a id="foottext-1" href="#footmark-1">^1</a> a-zA-Z0-9-_</p>

<p><a id="foottext-2" href="#footmark-2">^2</a> a-zA-Z0-9-._+</p>

<p><a id="foottext-3" href="#footmark-3">^3</a> a-zA-Z0-9-._+</p>

<p><a id="foottext-4" href="#footmark-4">^4</a> a-zA-Z0-9-._+</p>

</div>



<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.1.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

